<!Doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AutoSpawning</title>
    <script src="https://cdn.babylonjs.com/babylon.max.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <canvas id = "canvas"></canvas>
    <button id = "fsButton">Fullscreen</button>
    <p id = "demo"></p>
    <script>

        let dirk;
        let box;

        const setUp = () => {
        const canvas = document.getElementById('canvas');

        const engine = new BABYLON.Engine(canvas, true);
        
        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0.65, 0.81, 0.67);

            // Camera
            // position of the camera
            var camera = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(0, 5, -10), scene);

            //  where does the camera rotate to? in dit geval richt hij zich naar het middelpunt van de canvas
            camera.setTarget(BABYLON.Vector3.Zero());

            // Attach the camera to the canvas
            camera.attachControl(canvas, true);

            // light
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));
            
            BABYLON.SceneLoader.OnPluginActivatedObservable.addOnce(function (plugin) {
            plugin.animationStartMode = BABYLON.GLTFLoaderAnimationStartMode.ALL;
            });   




            // model


            BABYLON.SceneLoader.ImportMesh("","./models/","bodyTest.glb", scene, function(newMeshes){ 
                // dirk = [Linkerbeen, Rechterbeen, Body, Linkeroog, Rechteroog];
                // Linkerbeen = newMeshes[0];
                // Rechterbeen = newMeshes[1];
                // Body = newMeshes[2];
                // Linkeroog = newMeshes[3];
                // Rechteroog = newMeshes[4];
               
                console.log(newMeshes);
                const playerRunning = new BABYLON.TransformNode();

                newMeshes.forEach(mesh => {
                    if (!mesh.parent) {
                        mesh.parent = playerRunning;
                    }

                playerRunning.position = new BABYLON.Vector3(0,0,-4);
                playerRunning.scaling = new BABYLON.Vector3(.5, .5, .5);
                console.log(playerRunning);
                });

                // newMeshes[0].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[1].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[2].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[3].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[4].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[5].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[6].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[7].scaling = new BABYLON.Vector3(.2,.2,.2);
                // newMeshes[8].scaling = new BABYLON.Vector3(.2,.2,.2);
                // dirk.position = new BABYLON.Vector3(0,1,-4);
                // dirk.scaling = new BABYLON.Vector3(3,33,); 
            });  
            
            // if (dirk.intersectsMesh(box, false)) {
            //    console.log("boem");
            // }


           // Attach camera to canvas inputs
            scene.activeCamera.attachControl(canvas);

            // Once the scene is loaded, register a render loop
            engine.runRenderLoop(function() {
                scene.render();
            });


            // ground
            const ground = BABYLON.MeshBuilder.CreateGround("ground", {height: 150, width: 9, subdivisions: 4});
            ground.position = new BABYLON.Vector3(0,0,7);

            const groundMaterial = new BABYLON.StandardMaterial("groundMaterial", scene);
            groundMaterial.emissiveColor = new BABYLON.Color3(0.85, 0.77, 0.60);
            ground.material = groundMaterial;

            //keyboard input "w" en "x"
            scene.onKeyboardObservable.add((kbInfo) => {
                switch (kbInfo.type) {
                    case BABYLON.KeyboardEventTypes.KEYDOWN:
                        switch (kbInfo.event.key) {
                            case "w":
                            case "W" : 
                                dirk.position.x -= 3;
                            break;
                            case "x":
                            case "X":
                                dirk.position.x += 3;
                            break;
                        }
                    break;
                }
            })
            return scene;
        }

        const scene = createScene();
        engine.runRenderLoop(function () {
            scene.render();

        });
    }
    
        var canvasElement = document.getElementById("canvas");
        const fullscreen = () => {
            if (canvasElement.requestFullscreen) { /* other browsers*/
                canvasElement.requestFullscreen();
            } 
            else if (canvasElement.webkitRequestFullscreen) { /* Safari */
                canvasElement.webkitRequestFullscreen();
            } 
            else if (canvasElement.msRequestFullscreen) { /* IE11 */
                canvasElement.msRequestFullscreen();
            }        
        }
        window.addEventListener('DOMContentLoaded', setUp());
        document.getElementById("fsButton").addEventListener("click", fullscreen);

    </script>

</body>
</html>

